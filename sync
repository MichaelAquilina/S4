#! /usr/bin/env python

import os
import json

import s3backup
from s3backup.clients import local


def main():

    config_path = os.path.expanduser('~/.config/s3backup/sync.conf')
    if not os.path.exists(config_path):
        raise ValueError('Expected Config file:', config_path)

    with open(config_path, 'r') as fp:
        config = json.load(fp)

    for target_1, target_2 in config['directories'].items():
        client_1 = local.LocalSyncClient(target_1)
        client_2 = local.LocalSyncClient(target_2)

        print('Syncing', target_1, 'with', target_2)
        s3backup.sync(client_1, client_2)

if __name__ == '__main__':
    main()
